# Werker config
box: drewwells/drunken-golang@0.0.0
build:
  steps:
    - setup-go-workspace

    - script:
        name: build libsass
        code: |
          git submodule update --init --recursive
          cd libsass
          make

    # Get dependencies
    - script:
        name: go get
        code: |
          cd $WERCKER_SOURCE_DIR
          go get -t ./...

    # Build the project
    - script:
        name: go build
        code: |
          go build ./...
    - script:
        name: go test
        code: |
          go test -cover
    - script:
        name: Coveralls.io
        code: |
          # The COVERALLS_TOKEN is set in the project at
          # wercker as project environment variable.
          go get github.com/axw/gocov/gocov
          go get github.com/mattn/goveralls
          go test -v -covermode=count -coverprofile=coverage.out
          GIT_BRANCH=$WERCKER_GIT_BRANCH goveralls -coverprofile=coverage.out -service=wercker.com -repotoken $COVERALLS_TOKEN
deploy:
  steps:
    - github-upload-asset:
        token: $GITHUB_TOKEN
        file: $($GOPATH/bin/sprite)
        release_id: 1
  # steps:
  #   - script:
  #       name: get version
  #       code: |
  #         export APP_VERSION=$(go run sprite/main.go --version)
  #         export SPRITE=$($GOPATH/bin/sprite)
  #         echo $SPRITE
  #   - wercker/github-create-release@1.0.1:
  #       token: $GITHUB_TOKEN
  #       tag: $APP_VERSION
  #       title: Sprite sass tool $APP_VERSION
  #       draft: true
  #   - github-upload-asset:
  #       token: $GITHUB_TOKEN
  #       file: $SPRITE
  #       filename: sprite
