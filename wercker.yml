# Werker config
box: wercker/golang
build:
  steps:
    - install-packages:
        packages: libgif-dev
    - setup-go-workspace
    - script:
        name: build libsass
        code: |
          git submodule update --init --recursive
          cd libsass
          make
    - script:
        name: go get
        code: |
          go get
    - script:
        name: go test
        code: |
          go test
    # - script:
    #     name: Coverage
    #     code: |-
    #       go get github.com/axw/gocov/gocov
    #       gocov report coverage.json
    #       gocov test > coverage.json
    #       go get github.com/matm/gocov-html
    #       gocov report coverage.json
    #       gocov-html coverage.json > $WERCKER_REPORT_ARTIFACTS_DIR/coverage.html
    - script:
        name: Coveralls.io
        code: |-
          # The COVERALLS_TOKEN is set in the project at
          # wercker as project environment variable.
          go get github.com/axw/gocov/gocov
          go get github.com/mattn/goveralls
          go test -v -covermode=count -coverprofile=coverage.out
          GIT_BRANCH=$WERCKER_GIT_BRANCH goveralls -coverprofile=coverage.out -service=wercker.com -repotoken $COVERALLS_TOKEN
